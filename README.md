# Mattermost vote-bot

## 1 Настройка Mattermost

В папке `mattermost` выполняем команду `docker-compose up -d mattermost`

Затем переходим по ссылке `http://localhost:8065/` и создаем пользователя, затем создаем организацию, например `test-org` (понадобится в дальнейшем).

Теперь настроим все для работы бота, нам нужно зайти в System console (левый верхний угол) и там настроить пару параметров:
	1.  `Allow untrusted internal connections to`: Здесь мы добавляем в поле `host.docker.internal`
	2.  `Enable Bot Account Creation`: Ставим `true`

Затем создаем бота. Переходим по ссылке `Bot Accounts` из `Enable Bot Account Creation`, жмем на кнопку создания бота и создаем бота со следующими параметрами:
	1. `Username`: `vote-bot`
	2. `Display name`: `Voting bot`
	3. `Role`: Ставим `System Admin`

Сохраняем бота и не забываем скопировать его токен

Теперь mattermost готов.

## 2. Настройка окружения и запуск бота

Теперь нужно отредактировать окружение для бота в файле `docker-compose.yml` в корне репозитория.
	1. `MM_TOKEN`: Ставим после `=` раннее скопированный токен бота
	2. `MM_SERVER`: Ставим после `=' ссылку на сервер, в нашем случае http://host.docker.internal:8065'
	3. `MM_TEAM`: Ставим после `=` имя организации, в нашем случае это `test-org`
	4. `MM_USERNAME`: Ставим после `=` имя бота, в нашем случае это `vote-bot`

Остальные параметры менять на свое усмотрение

Теперь запускаем бота командой `docker-compose up --build`, ждем пока бот запустится , бот запустится после того как увидите в консоли следующий лог `vote-bot        | 2025/03/30 19:56:24 main.go:228: Starting command server on port 8088
`
Теперь все работает, можно пользоваться

# Краткая инструкция по использованию бота

Бот работает на основе слэш команд, то есть его команды можно вызвать в любом чате, для того чтоб увидеть список всех команд можно написать в любой чат `/vote-bot-help`

## Доступные команды

### 1. Создание опроса
```/poll "Вопрос" "Вариант1" "Вариант2"...```

**Описание**: Создает новый опрос с указанным вопросом и вариантами ответов, в ответе будет виден ID опроса.

**Пример**: `/poll "Какой ваш любимый цвет?" "Красный" "Синий" "Зеленый"`

---

### 2. Голосование в опросе
```/vote <ID_опроса> <номер_варианта>```

**Описание**: Позволяет проголосовать за выбранный вариант в существующем опросе.

**Пример**: `/vote 42 2` (голосует за вариант 2 в опросе с ID 42)

---

### 3. Просмотр результатов
```/get-poll <ID_опроса>```

**Описание**: Показывает текущие результаты указанного опроса по его ID.

**Пример**: `/get-poll 42`


---

### 4. Закрытие опроса
```/close-poll <ID_опроса>```

**Описание**: Закрывает опрос по ID(может исполнить только создатель опроса).

**Пример**: `/close-poll 42`

---

### 5. Удаление опроса
```/delete-poll <ID_опроса>```

**Описание**: Удаляет опрос по ID(может исполнить только создатель опроса).

**Пример**: `/delete-poll 42`

---

### 6. Справка
```/vote-bot-help```

**Описание**: Показывает это справочное сообщение.

---

##  Примечания

- **ID опроса** отображается при его создании
- Закрывать и удалять опросы может только их создатель
- Все команды привязано к каналу, где создан опрос
- Для указания вопросов и вариантов используйте кавычки `"`

